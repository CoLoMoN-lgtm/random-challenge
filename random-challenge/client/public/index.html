<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–ø–∞–¥–∫–æ–≤–∏–π –≤–∏–∫–ª–∏–∫</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        .spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500">
    <div class="flex flex-col items-center p-4">
        <header class="text-center mb-8 mt-8">
            <h1 class="text-4xl font-bold text-white mb-2">
                ‚ú® –í–∏–ø–∞–¥–∫–æ–≤–∏–π –≤–∏–∫–ª–∏–∫
            </h1>
            <p class="text-white text-xl">–í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ –º–∞–ª–µ–Ω—å–∫—ñ –ø—Ä–∏–≥–æ–¥–∏</p>
        </header>

        <div class="w-full max-w-2xl bg-white rounded-lg shadow-xl p-6">
            <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
            <div class="mb-6">
                <label class="flex items-center text-lg text-gray-700 mb-2">
                    üîç –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é:
                </label>
                <div class="flex flex-wrap gap-2" id="categories">
                    <button onclick="selectCategory('all')" class="category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-800 text-white" data-category="all">
                        –í—Å—ñ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
                    </button>
                </div>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∞ -->
            <div class="flex justify-center mb-8">
                <button onclick="getRandomChallenge()" id="generateBtn" class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-8 py-4 rounded-full text-xl font-bold shadow-lg hover:from-indigo-700 hover:to-purple-700 transition-all transform hover:scale-105">
                    ‚ú® –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–∫–ª–∏–∫!
                </button>
            </div>

            <!-- –í–∏–∫–ª–∏–∫ -->
            <div id="challengeDisplay" class="hidden animate-fade-in">
                <div id="challengeCard" class="p-6 rounded-lg mb-4 border-l-8 border-gray-500">
                    <div class="flex justify-between items-start mb-3">
                        <span id="difficultyBadge" class="text-sm font-medium px-3 py-1 rounded-full bg-gray-200 text-gray-800">
                        </span>
                        <span id="categoryName" class="text-sm text-gray-600">
                        </span>
                    </div>
                    <h2 id="challengeText" class="text-2xl font-bold text-gray-800"></h2>
                </div>
                
                <div class="flex justify-center">
                    <button onclick="getRandomChallenge()" class="text-purple-600 hover:text-purple-800">
                        üîÑ –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —ñ–Ω—à–∏–π
                    </button>
                </div>
            </div>

            <!-- –î–æ–¥–∞—Ç–∏ –≤–∏–∫–ª–∏–∫ -->
            <div class="mt-8 text-center">
                <button onclick="toggleForm()" id="toggleFormBtn" class="text-indigo-600 hover:text-indigo-800">
                    ‚ûï –î–æ–¥–∞—Ç–∏ —Å–≤—ñ–π –≤–∏–∫–ª–∏–∫
                </button>
            </div>

            <div id="newChallengeForm" class="mt-4 p-4 border rounded-lg hidden">
                <h3 class="text-lg font-medium mb-3">–ù–æ–≤–∏–π –≤–∏–∫–ª–∏–∫</h3>
                
                <input type="text" id="newChallengeText" placeholder="–¢–µ–∫—Å—Ç –≤–∏–∫–ª–∏–∫—É" class="w-full px-3 py-2 border rounded-md mb-3">
                
                <select id="newChallengeCategory" class="w-full px-3 py-2 border rounded-md mb-3">
                    <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                </select>
                
                <div class="mb-4">
                    <label class="block mb-1">–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:</label>
                    <div class="flex gap-3">
                        <label><input type="radio" name="difficulty" value="easy" checked> –õ–µ–≥–∫–∏–π</label>
                        <label><input type="radio" name="difficulty" value="medium"> –°–µ—Ä–µ–¥–Ω—ñ–π</label>
                        <label><input type="radio" name="difficulty" value="hard"> –°–∫–ª–∞–¥–Ω–∏–π</label>
                    </div>
                </div>
                
                <button onclick="addChallenge()" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700">
                    –ó–±–µ—Ä–µ–≥—Ç–∏
                </button>
            </div>

            <!-- –°—Ç–∞—Ç—É—Å -->
            <div class="mt-8 text-center">
                <p id="status" class="text-sm text-gray-600">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://random-challenge.onrender.com/api';
        let categories = [];
        let selectedCategory = 'all';

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π
        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/categories`);
                categories = await response.json();
                
                const container = document.getElementById('categories');
                const allBtn = container.querySelector('[data-category="all"]');
                
                categories.forEach(cat => {
                    const btn = document.createElement('button');
                    btn.onclick = () => selectCategory(cat._id);
                    btn.className = 'category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300';
                    btn.setAttribute('data-category', cat._id);
                    btn.textContent = cat.name;
                    container.appendChild(btn);
                });

                // –ó–∞–ø–æ–≤–Ω—é—î–º–æ select –¥–ª—è —Ñ–æ—Ä–º–∏
                const select = document.getElementById('newChallengeCategory');
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat._id;
                    option.textContent = cat.name;
                    select.appendChild(option);
                });

                updateStatus('‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ API');
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                updateStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ API');
            }
        }

        function selectCategory(categoryId) {
            selectedCategory = categoryId;
            
            document.querySelectorAll('.category-btn').forEach(btn => {
                const btnCategory = btn.getAttribute('data-category');
                if (btnCategory === categoryId) {
                    btn.className = 'category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-800 text-white';
                } else {
                    btn.className = 'category-btn px-4 py-2 rounded-full text-sm font-medium bg-gray-200 text-gray-800 hover:bg-gray-300';
                }
            });
        }

        async function getRandomChallenge() {
            const btn = document.getElementById('generateBtn');
            btn.innerHTML = 'üîÑ –ì–µ–Ω–µ—Ä—É—î–º–æ...';
            btn.disabled = true;

            try {
                const url = selectedCategory === 'all' 
                    ? `${API_URL}/challenges/random`
                    : `${API_URL}/challenges/random?category=${selectedCategory}`;
                
                const response = await fetch(url);
                
                if (response.ok) {
                    const challenge = await response.json();
                    displayChallenge(challenge);
                } else {
                    updateStatus('‚ùå –ù–µ–º–∞—î –≤–∏–∫–ª–∏–∫—ñ–≤ –≤ —Ü—ñ–π –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                updateStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏–∫–ª–∏–∫—É');
            }

            btn.innerHTML = '‚ú® –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–∫–ª–∏–∫!';
            btn.disabled = false;
        }

        function displayChallenge(challenge) {
            const display = document.getElementById('challengeDisplay');
            const text = document.getElementById('challengeText');
            const badge = document.getElementById('difficultyBadge');
            const categoryName = document.getElementById('categoryName');

            text.textContent = challenge.text;

            // –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å
            const difficultyMap = {
                easy: { class: 'bg-green-200 text-green-800', name: '–õ–µ–≥–∫–∏–π' },
                medium: { class: 'bg-yellow-200 text-yellow-800', name: '–°–µ—Ä–µ–¥–Ω—ñ–π' },
                hard: { class: 'bg-red-200 text-red-800', name: '–°–∫–ª–∞–¥–Ω–∏–π' }
            };
            
            const diff = difficultyMap[challenge.difficulty] || difficultyMap.medium;
            badge.className = `text-sm font-medium px-3 py-1 rounded-full ${diff.class}`;
            badge.textContent = diff.name;

            // –ö–∞—Ç–µ–≥–æ—Ä—ñ—è
            const cat = categories.find(c => c._id === challenge.categoryId);
            categoryName.textContent = cat ? cat.name : '–ù–µ–≤—ñ–¥–æ–º–∞';

            display.classList.remove('hidden');
        }

        function toggleForm() {
            const form = document.getElementById('newChallengeForm');
            const btn = document.getElementById('toggleFormBtn');
            
            if (form.classList.contains('hidden')) {
                form.classList.remove('hidden');
                btn.textContent = '‚ûñ –°–∫–∞—Å—É–≤–∞—Ç–∏';
            } else {
                form.classList.add('hidden');
                btn.textContent = '‚ûï –î–æ–¥–∞—Ç–∏ —Å–≤—ñ–π –≤–∏–∫–ª–∏–∫';
            }
        }

        async function addChallenge() {
            const text = document.getElementById('newChallengeText').value;
            const categoryId = document.getElementById('newChallengeCategory').value;
            const difficulty = document.querySelector('input[name="difficulty"]:checked').value;

            if (!text || !categoryId) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/challenges`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, categoryId, difficulty })
                });

                if (response.ok) {
                    const challenge = await response.json();
                    displayChallenge(challenge);
                    toggleForm();
                    
                    // –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É
                    document.getElementById('newChallengeText').value = '';
                    document.getElementById('newChallengeCategory').value = '';
                    document.querySelector('input[name="difficulty"][value="easy"]').checked = true;
                    
                    updateStatus('‚úÖ –í–∏–∫–ª–∏–∫ –¥–æ–¥–∞–Ω–æ!');
                } else {
                    updateStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–∏–∫–ª–∏–∫—É');
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞:', error);
                updateStatus('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑\'—î–¥–Ω–∞–Ω–Ω—è');
            }
        }

        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        window.addEventListener('load', loadCategories);
    </script>
</body>
</html>
